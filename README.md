# بوت ChatGPTPlus2FABot: إدارة رموز 2FA عبر تليجرام

هذا البوت مصمم لتسهيل مشاركة رموز المصادقة الثنائية (2FA) المستندة إلى TOTP (Time-Based One-Time Password) داخل مجموعات تليجرام بشكل آمن ومنظم.

## الميزات الرئيسية

*   **إرسال دوري للرسائل**: يقوم البوت بإرسال رسالة إلى المجموعات المسجلة بشكل دوري (الافتراضي كل 10 دقائق) تحتوي على زر لطلب رمز 2FA.
*   **طلب الرمز برسالة خاصة**: عند الضغط على زر "نسخ الرمز"، يتم إرسال رمز 2FA الحالي للمستخدم في رسالة خاصة، مما يمنع عرض الرمز للجميع في المجموعة.
*   **تنسيقات رسائل متعددة**: يمكن للمسؤول اختيار شكل الرسالة الدورية (عرض الوقت المتبقي، مدة الصلاحية، الوقت الحالي).
*   **إدارة المحاولات**: يحدد المسؤول عدد المحاولات المسموح بها لكل مستخدم لطلب الرمز يومياً (الافتراضي 3). يتم إعادة تعيين المحاولات تلقائياً (يتطلب إعداد cron job).
*   **لوحة تحكم للمسؤول**: يوفر البوت واجهة تحكم سهلة الاستخدام للمسؤولين عبر الأمر `/admin` لإدارة:
    *   المجموعات (إضافة، تعديل، حذف).
    *   مفاتيح TOTP السرية لكل مجموعة.
    *   فترة تكرار إرسال الرسائل لكل مجموعة.
    *   شكل الرسالة والمنطقة الزمنية لكل مجموعة.
    *   محاولات المستخدمين (إضافة/حذف محاولات، حظر/إلغاء حظر).
    *   المسؤولين (إضافة، إزالة).
*   **قاعدة بيانات SQLite**: يتم تخزين جميع الإعدادات والبيانات في ملف قاعدة بيانات SQLite محلي.

## المتطلبات

*   Python 3.7 أو أحدث.
*   مكتبات Python المذكورة في ملف `requirements.txt`.
*   توكن بوت تليجرام (يمكن الحصول عليه من @BotFather).
*   معرف المستخدم (User ID) للمسؤول الأولي.

## التثبيت والإعداد

1.  **استنساخ المستودع (اختياري)**:
    ```bash
    git clone https://github.com/NaJiKuN/ChatGPTPlus2FABot.git
    cd ChatGPTPlus2FABot
    ```
    أو قم بنقل جميع الملفات المرفقة إلى مجلد المشروع على الخادم الخاص بك، على سبيل المثال: `/home/ec2-user/projects/ChatGPTPlus2FABot`.

2.  **إنشاء بيئة افتراضية (مستحسن)**:
    ```bash
    python3 -m venv venv
    source venv/bin/activate  # لنظام Linux/macOS
    # venv\Scripts\activate  # لنظام Windows
    ```

3.  **تثبيت المكتبات المطلوبة**:
    ```bash
    pip install -r requirements.txt
    ```

4.  **تعديل ملف الإعدادات (`config.py`)**:
    *   استبدل `"YOUR_BOT_TOKEN"` بالتوكن الخاص ببوت تليجرام.
    *   استبدل `123456789` بمعرف المستخدم الخاص بك ليكون المسؤول الأولي.

## التشغيل

1.  **تشغيل البوت مباشرة**:
    ```bash
    cd /home/ec2-user/projects/ChatGPTPlus2FABot
    python3 bot.py
    ```

2.  **تشغيل البوت في الخلفية باستخدام `screen` (مستحسن للتشغيل المستمر)**:
    *   تثبيت `screen` إذا لم يكن مثبتاً:
        ```bash
        sudo apt update && sudo apt install screen  # لأنظمة Debian/Ubuntu
        sudo yum update && sudo yum install screen  # لأنظمة CentOS/RHEL/Fedora
        ```
    *   بدء جلسة `screen` جديدة:
        ```bash
        screen -S 2fa_bot
        ```
    *   الانتقال إلى مجلد البوت وتشغيله:
        ```bash
        cd /home/ec2-user/projects/ChatGPTPlus2FABot
        python3 bot.py
        ```
    *   الخروج من جلسة `screen` (سيبقى البوت يعمل في الخلفية): اضغط `Ctrl+A` ثم `D`.
    *   للعودة إلى الجلسة لاحقاً:
        ```bash
        screen -r 2fa_bot
        ```

## الاستخدام

1.  **المسؤول**: ابدأ محادثة مع البوت وأرسل الأمر `/admin` للوصول إلى لوحة التحكم.
2.  **إضافة مجموعة**: من لوحة التحكم، اختر "إدارة Groups/TOTP_SECRET" ثم "إضافة مجموعة". اتبع التعليمات لإدخال معرف المجموعة والمفتاح السري TOTP.
3.  **تخصيص الإعدادات**: استخدم لوحة التحكم لتعديل فترة التكرار، شكل الرسالة، والحد الأقصى للمحاولات لكل مجموعة.
4.  **المستخدمون**: يمكن للمستخدمين في المجموعات المسجلة الضغط على زر "نسخ الرمز" في الرسائل الدورية للحصول على رمز 2FA في رسالة خاصة.

## ملاحظات هامة

*   **الحصول على معرف المجموعة**: لإضافة مجموعة، ستحتاج إلى معرفها (Group ID). يمكنك الحصول عليه بسهولة عن طريق إضافة البوت `@username_to_id_bot` إلى مجموعتك وإرسال أي رسالة. سيرد البوت بمعرف المجموعة.
*   **صحة المفتاح السري TOTP**: تأكد من إدخال المفتاح السري TOTP الصحيح بتنسيق Base32 عند إضافة أو تعديل مجموعة.
*   **إعادة تعيين المحاولات اليومية**: البوت لا يقوم بإعادة تعيين المحاولات تلقائياً عند منتصف الليل. يجب إعداد مهمة مجدولة (cron job) على الخادم لتنفيذ سكريبت يقوم بتحديث عمود `attempts_left` في جدول `user_attempts` لجميع المستخدمين في بداية كل يوم حسب المنطقة الزمنية المطلوبة.
*   **الأمان**: تعامل مع توكن البوت والمفاتيح السرية TOTP بحذر. لا تشاركها مع أي شخص غير موثوق.

## المساهمة

نرحب بالمساهمات لتحسين هذا البوت. يمكنك فتح Issues للإبلاغ عن الأخطاء أو اقتراح ميزات جديدة، أو تقديم Pull Requests بالتعديلات.
