# دليل استخدام بوت تليجرام للمصادقة الثنائية 2FA

## نظرة عامة

بوت ChatGPTPlus2FABot هو بوت تليجرام متخصص في إرسال رموز المصادقة الثنائية 2FA للمستخدمين بشكل دوري. يتميز البوت بالخصائص التالية:

- إرسال رموز المصادقة الثنائية 2FA بشكل دوري في المجموعات
- إمكانية تخصيص فترة التكرار (1 دقيقة، 5 دقائق، 10 دقائق، إلخ)
- إمكانية تخصيص شكل وتوقيت الرسائل
- إدارة محاولات المستخدمين للحصول على الرموز
- لوحة تحكم للمسؤولين مع أزرار ديناميكية احترافية

## متطلبات التشغيل

- بيئة Python 3.6 أو أحدث
- المكتبات التالية: python-telegram-bot، pyotp، python-dateutil
- خادم مستمر التشغيل (مثل AWS EC2)

## طريقة التثبيت

### 1. تثبيت البوت على خادم AWS EC2

```bash
# الاتصال بالخادم
ssh ec2-user@your-ec2-instance-ip

# إنشاء مجلد المشروع
mkdir -p /home/ec2-user/projects/ChatGPTPlus2FABot

# نسخ ملفات البوت إلى المجلد
# (يمكنك استخدام scp أو git clone)

# تنفيذ سكريبت التثبيت
cd /home/ec2-user/projects/ChatGPTPlus2FABot
sudo bash install_service.sh
```

### 2. التثبيت اليدوي

```bash
# تثبيت المتطلبات
pip3 install python-telegram-bot pyotp python-dateutil

# تشغيل البوت
python3 bot.py
```

## طريقة الاستخدام

### للمسؤولين

1. بدء محادثة مع البوت وإرسال الأمر `/admin`
2. استخدام لوحة التحكم للوصول إلى الوظائف التالية:

#### إدارة المجموعات/TOTP_SECRET
- إضافة مجموعة جديدة مع TOTP_SECRET
- حذف مجموعة موجودة
- تعديل TOTP_SECRET لمجموعة موجودة

#### إدارة فترة التكرار
- تعيين فترة التكرار لإرسال الرموز (1 دقيقة، 5 دقائق، 10 دقائق، إلخ)
- إيقاف/بدء التكرار لمجموعة محددة

#### إدارة شكل/توقيت الرسالة
- اختيار شكل الرسالة من بين ثلاثة أنماط مختلفة
- اختيار المنطقة الزمنية (توقيت غرينتش أو توقيت غزة)

#### إدارة محاولات المستخدمين
- عرض عدد المحاولات المتبقية لكل مستخدم
- إضافة أو حذف محاولات للمستخدمين
- حظر أو إلغاء حظر المستخدمين

#### إدارة المسؤولين
- إضافة مسؤولين جدد عن طريق معرف المستخدم (User ID)
- إزالة مسؤولين موجودين

### للمستخدمين العاديين

1. الانضمام إلى مجموعة تم إعدادها مسبقاً من قبل المسؤول
2. عند ظهور رسالة "2FA Verification Code"، يمكن للمستخدم النقر على زر "Copy Code"
3. سيتلقى المستخدم رمز المصادقة في رسالة خاصة مع معلومات عن:
   - رمز المصادقة الثنائية القابل للنسخ
   - الوقت المتبقي لصلاحية الرمز (30 ثانية)
   - عدد المحاولات المتبقية لليوم الحالي

## ملاحظات هامة

- يجب أن يكون البوت عضواً في المجموعة مع صلاحيات كافية لإرسال الرسائل
- يجب على المستخدمين بدء محادثة مع البوت قبل النقر على زر "Copy Code" ليتمكن البوت من إرسال رسائل خاصة لهم
- يتم إعادة تعيين عدد المحاولات يومياً عند منتصف الليل
- يجب تشغيل البوت بشكل مستمر على الخادم لضمان إرسال الرسائل الدورية

## استكشاف الأخطاء وإصلاحها

### البوت لا يرسل رسائل دورية
- تأكد من أن خدمة البوت تعمل: `systemctl status telegram-2fa-bot.service`
- تحقق من سجلات النظام: `journalctl -u telegram-2fa-bot.service`
- تأكد من إضافة المجموعة بشكل صحيح مع TOTP_SECRET صالح

### المستخدمون لا يتلقون رموز المصادقة
- تأكد من أن المستخدمين قد بدأوا محادثة مع البوت
- تحقق من عدد المحاولات المتبقية للمستخدمين
- تأكد من أن المستخدمين غير محظورين

### خطأ في TOTP_SECRET
- تأكد من أن TOTP_SECRET المدخل صالح ويتبع التنسيق المطلوب
- جرب إنشاء TOTP_SECRET جديد واختباره

## الأمان والخصوصية

- رموز المصادقة الثنائية 2FA تُرسل فقط في رسائل خاصة للمستخدمين
- يتم تخزين TOTP_SECRET بشكل آمن في ملف التكوين
- يتم تقييد الوصول إلى لوحة التحكم للمسؤولين فقط

## التخصيص المتقدم

يمكن تخصيص البوت بشكل أكبر عن طريق تعديل الكود المصدري. بعض الأمثلة:

- تغيير عدد المحاولات الافتراضية اليومية
- إضافة أنماط إضافية للرسائل
- تعديل مدة صلاحية الرمز (الافتراضي 30 ثانية حسب معيار TOTP)
